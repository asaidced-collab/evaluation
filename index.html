<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุงุณุชูุงุฑุฉ ุงูุชุญููู โ ุงููุณุฎุฉ ุงููุงููุฉ</title>
  <style>
    body { font-family: system-ui,"Segoe UI",Tahoma,Arial; line-height:1.7; margin:0; background:#fafafa; color:#222; }
    .container { max-width:1000px; margin:24px auto; background:#fff; padding:24px; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    h1,h2,h3 { margin-top:0; }
    .toolbar { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 16px; }
    .page { display:none; }
    .page.active { display:block; }
    .navigation-buttons { display:flex; gap:12px; margin-top:20px; }
    .btn { padding:10px 16px; border:none; border-radius:10px; cursor:pointer; background:#1a73e8; color:#fff; font-weight:600; }
    .btn-secondary { background:#737373; }
    .btn-ghost { background:#eef2ff; color:#1e3a8a; }
    .btn-danger { background:#e11d48; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .progress { background:#eee; height:10px; border-radius:999px; overflow:hidden; margin:16px 0 24px; }
    .progress > span { display:block; height:100%; width:0%; background:#1a73e8; transition:width .3s; }
    .field { margin:12px 0; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input[type="text"],input[type="number"],input[type="email"],textarea,select { width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; }
    .hint { color:#666; font-size:.9em; }
    .grid { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:16px; }
    .grid .field:nth-child(4) { grid-column: span 3; }
    .item-block hr { border:none; border-top:1px dashed #ddd; margin:16px 0; }
    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      .grid .field:nth-child(4) { grid-column: span 1; }
    }

    /* ุฅุจุฑุงุฒ ุงูุญููู ุงููุงูุตุฉ */
    .field.invalid { border:1px solid #e11d48 !important; background:#fff1f2; padding:10px; border-radius:10px; }
    .field.invalid label::after { content:" * ูุทููุจ"; color:#e11d48; margin-right:6px; font-weight:700; }

    /* ุดุงุฑุฉ ุชูุถูุญูุฉ ุฃุนูู ุงูุชูููู ุงูููู */
    .overall-note { background:#f1f5ff; border:1px dashed #93c5fd; padding:8px 12px; border-radius:10px; font-size:.95em; color:#1e3a8a; }

    /* ุฌุฏูู ุงููุนุงููุฉ */
    .preview-section { margin: 16px 0 24px; }
    .preview-table { width:100%; border-collapse: collapse; }
    .preview-table th, .preview-table td { border:1px solid #e5e7eb; padding:8px 10px; vertical-align:top; }
    .preview-table th { background:#f9fafb; text-align:right; white-space:nowrap; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ุงุณุชูุงุฑุฉ ุงูุชุญููู โ ุงููุณุฎุฉ ุงููุงููุฉ</h1>

    <!-- ุดุฑูุท ุฃุฏูุงุช ุงูุญูุธ ุงููุญูู -->
    <div class="toolbar">
      <button class="btn btn-ghost" type="button" onclick="saveToLocal()">๐พ ุญูุธ ูุญูููุง</button>
      <button class="btn btn-ghost" type="button" onclick="loadFromLocal()">โณ ุงุณุชุฑุฌุงุน</button>
      <button class="btn btn-danger" type="button" onclick="clearAll()">โ ุชูุฑูุบ ุงูุจูุงูุงุช</button>
    </div>

    <div class="progress"><span id="progressFill"></span></div>

    <div id="pages">
      <!-- ุงูุตูุญุฉ 0: ุชุฑุญูุจ -->
      <section class="page active" id="page0">
        <h2>ูุฑุญุจูุง ุจู</h2>
        <p>ูุฐู ุงููุณุฎุฉ ุงููุงููุฉ ูู ุงุณุชูุงุฑุฉ ุงูุชุญููู. ุงุถุบุท ุงูุฒุฑ ูุจุฏุก ุงูุฅุฏุฎุงู.</p>
        <div class="navigation-buttons">
          <button class="btn" type="button" onclick="nextPage()">ุจุฏุก ุงูุชุญููู</button>
        </div>
      </section>

      <!-- ุงูุตูุญุฉ 1: ุจูุงูุงุช ุนุงูุฉ -->
      <section class="page" id="page1">
        <h2>ุจูุงูุงุช ุงููุญููู</h2>
        <div class="grid">
          <div class="field">
            <label>ุงุณู ุงูููุญูููู</label>
            <input type="text" name="ุงุณู ุงูููุญูููู" placeholder="ูุซุงู: ุฏ. ุฃุญูุฏ" />
          </div>
          <div class="field">
            <label>ุงูุตูุฉ/ุงูุฏูุฑ</label>
            <select name="ุงูุตูุฉ/ุงูุฏูุฑ">
              <option value="">ุงุฎุชุฑ...</option>
              <option value="ุนุถู ููุฆุฉ ุชุฏุฑูุณ">ุนุถู ููุฆุฉ ุชุฏุฑูุณ</option>
              <option value="ุจุงุญุซ">ุจุงุญุซ</option>
              <option value="ูุดุฑู ุฃูุงุฏููู">ูุดุฑู ุฃูุงุฏููู</option>
              <option value="ุฎุจูุฑ ููุฏุงูู">ุฎุจูุฑ ููุฏุงูู</option>
            </select>
          </div>
          <div class="field">
            <label>ุณููุงุช ุงูุฎุจุฑุฉ</label>
            <input type="number" name="ุณููุงุช ุงูุฎุจุฑุฉ" min="0" max="60" placeholder="ุนุฏุฏ ุงูุณููุงุช" />
          </div>
          <div class="field">
            <label>ุทุจูุนุฉ ุงูุฎุจุฑุฉ ุจุงูุชุฑุจูุฉ ุงูุฏุงูุฌุฉ</label>
            <select name="ุทุจูุนุฉ ุงูุฎุจุฑุฉ ุจุงูุชุฑุจูุฉ ุงูุฏุงูุฌุฉ">
              <option value="">ุงุฎุชุฑ...</option>
              <option value="ุชุฏุฑูุณ">ุชุฏุฑูุณ</option>
              <option value="ุจุญุซ">ุจุญุซ</option>
              <option value="ุฅุฏุงุฑุฉ/ุชูููุฐ">ุฅุฏุงุฑุฉ/ุชูููุฐ</option>
              <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
            </select>
          </div>
          <div class="field">
            <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงุฎุชูุงุฑู)</label>
            <input type="email" name="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" />
          </div>
        </div>

        <div class="navigation-buttons">
          <button class="btn btn-secondary" type="button" onclick="prevPage()">ุงูุณุงุจู</button>
          <button class="btn" type="button" onclick="nextPage()">ุงูุชุงูู</button>
        </div>
      </section>
      <!-- ุงูุตูุญุงุช ุงูุจููุฏูุฉ ุณุชูููููุฏ ุจุฑูุฌููุง -->
    </div>

    <!-- ุตูุญุฉ ุงูุชุนูููุงุช ุงูุนุงูุฉ ูุงูุชูููู -->
    <section class="page" id="page999">
      <h2>ุชุนูููุงุช ุนุงูุฉ ูุชูููู ููุงุฆู</h2>

      <div class="overall-note" id="overallBadge">ุณููุญุณุจ ุงูุชูููู ุงูููู ุชููุงุฆููุง ูู ูุชูุณุท ุฏุฑุฌุงุช (ูุถูุญ/ููุงุกูุฉ/ุดููููุฉ) ููู ุงูุจููุฏ.</div>
      <br>

      <div class="grid">
        <div class="field">
          <label>ุชุนูููุงุช ุงููุญูุฑ 1</label>
          <textarea name="ุชุนูููุงุช ุงููุญูุฑ 1" rows="3"></textarea>
        </div>
        <div class="field">
          <label>ุชุนูููุงุช ุงููุญูุฑ 3</label>
          <textarea name="ุชุนูููุงุช ุงููุญูุฑ 3" rows="3"></textarea>
        </div>
        <div class="field">
          <label>ุชุนูููุงุช ุงููุญูุฑ 4</label>
          <textarea name="ุชุนูููุงุช ุงููุญูุฑ 4" rows="3"></textarea>
        </div>
        <div class="field">
          <label>ุชุนูููุงุช ุงููุญูุฑ 5</label>
          <textarea name="ุชุนูููุงุช ุงููุญูุฑ 5" rows="3"></textarea>
        </div>
        <div class="field">
          <label>ุชุนูููุงุช ุงููุญูุฑ 6</label>
          <textarea name="ุชุนูููุงุช ุงููุญูุฑ 6" rows="3"></textarea>
        </div>

        <div class="field">
          <label>ุงูุชูููู ุงูููู</label>
          <select name="ุงูุชูููู ุงูููู" id="overallSelect">
            <option value="">ุงุฎุชุฑ...</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
        </div>
        <div class="field">
          <label>ุดููู ุงูุชุบุทูุฉ</label>
          <select name="ุดููู ุงูุชุบุทูุฉ">
            <option value="">ุงุฎุชุฑ...</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
        </div>
        <div class="field">
          <label>ููุงุกูุฉ ุนุฏุฏ ุงูุจููุฏ</label>
          <select name="ููุงุกูุฉ ุนุฏุฏ ุงูุจููุฏ">
            <option value="">ุงุฎุชุฑ...</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
        </div>
        <div class="field">
          <label>ุงูุชูุตูุฉ ุงูููุงุฆูุฉ</label>
          <select name="ุงูุชูุตูุฉ ุงูููุงุฆูุฉ">
            <option value="">ุงุฎุชุฑ...</option>
            <option value="ูุนู">ูุนู</option>
            <option value="ุจุนุฏ ุชุนุฏููุงุช">ุจุนุฏ ุชุนุฏููุงุช</option>
            <option value="ูุง">ูุง</option>
          </select>
        </div>

        <div class="field" style="grid-column:1/-1">
          <label>ุนูุงุตุฑ ุงูููุฉ</label>
          <textarea name="ุนูุงุตุฑ ุงูููุฉ" rows="3"></textarea>
        </div>
        <div class="field" style="grid-column:1/-1">
          <label>ูุฌุงูุงุช ุงูุชุญุณูู</label>
          <textarea name="ูุฌุงูุงุช ุงูุชุญุณูู" rows="3"></textarea>
        </div>
        <div class="field" style="grid-column:1/-1">
          <label>ููุงุญุธุงุช ุนุงูุฉ</label>
          <textarea name="ููุงุญุธุงุช ุนุงูุฉ" rows="3"></textarea>
        </div>
      </div>

      <div class="navigation-buttons">
        <button class="btn btn-secondary" type="button" onclick="prevPage()">ุงูุณุงุจู</button>
        <button class="btn" type="button" onclick="nextPage()">ุงูุชุงูู</button>
      </div>
    </section>

    <!-- ุตูุญุฉ ุงููุนุงููุฉ -->
    <section class="page" id="pagePreview">
      <h2>ูุนุงููุฉ ูุจู ุงูุฅุฑุณุงู</h2>
      <p class="hint">ุฑุงุฌุน ุงูููุฎุต ุฃุฏูุงู. ููููู ุงูุฑุฌูุน ูุชุนุฏูู ุฃู ูููุฉุ ุซู ุงูุนูุฏุฉ ูููุนุงููุฉ ูุฌุฏุฏูุง.</p>

      <div class="preview-section">
        <h3>ุงูุจูุงูุงุช ุงูุนุงูุฉ</h3>
        <table class="preview-table" id="previewGeneral"></table>
      </div>

      <div class="preview-section">
        <h3>ููุฎุต ุงูุจููุฏ</h3>
        <table class="preview-table" id="previewItems"></table>
      </div>

      <div class="preview-section">
        <h3>ุงูุชููููุงุช ุงูููุงุฆูุฉ</h3>
        <table class="preview-table" id="previewFinals"></table>
      </div>

      <div class="navigation-buttons">
        <button class="btn btn-secondary" type="button" onclick="prevPage()">ุงูุณุงุจู (ุชุนุฏูู)</button>
        <button class="btn" type="button" onclick="nextPage()">ุงูุชุงูู (ุฅุฑุณุงู)</button>
      </div>
    </section>

    <!-- ุตูุญุฉ ุงูุฅุฑุณุงู -->
    <section class="page" id="page1000">
      <h2>ุฅุฑุณุงู ุงูุชุญููู</h2>
      <p class="hint">ุนูุฏ ุงูุถุบุท ุนูู "ุฅุฑุณุงู ุงูุชุญููู" ุณูุชู ุฅุฑุณุงู ุฌููุน ุงูุจูุงูุงุช ุฅูู Google Sheet.</p>
      <div class="navigation-buttons">
        <button class="btn btn-secondary" type="button" onclick="prevPage()">ุงูุณุงุจู</button>
        <button class="btn" type="button" onclick="submitForm()">ุฅุฑุณุงู ุงูุชุญููู</button>
      </div>
    </section>

  </div>

  <script>
    // ========= ุฅุนุฏุงุฏุงุช =========
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzCQrG9O7EeWSqtjNludnMP8rukeeKqqVSY8aAKZRb_ZfuaSTc_LDWlDspGniPOQvN1zA/exec';
    const STORAGE_KEY = 'evaluationFormData';
    const ITEM_NUMBERS = [1,2,3,4,5,6, 13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36];
    const PARTS = ['ูุถูุญ','ููุงุกูุฉ','ุดููููุฉ'];

    // ========= ุฅูุดุงุก ุตูุญุงุช ุงูุจููุฏ ุฏููุงูููููุง =========
    function createItemBlock(n) {
      return `
        <div class="item-block">
          <h3>ุงูุจูุฏ ${n}</h3>
          <p class="hint"><em>ุถุน ูุต ุงูุจูุฏ ููุง ูู ุฑุบุจุช (ุงุฎุชูุงุฑู)</em></p>

          <div class="grid">
            <div class="field">
              <label>ุงูุจูุฏ ${n} โ ูุถูุญ</label>
              <div>
                ${[1,2,3,4,5].map(i => `<label><input type="radio" name="ุงูุจูุฏ ${n} โ ูุถูุญ" value="${i}"> ${i}</label>`).join(' ')}
              </div>
            </div>

            <div class="field">
              <label>ุงูุจูุฏ ${n} โ ููุงุกูุฉ</label>
              <div>
                ${[1,2,3,4,5].map(i => `<label><input type="radio" name="ุงูุจูุฏ ${n} โ ููุงุกูุฉ" value="${i}"> ${i}</label>`).join(' ')}
              </div>
            </div>

            <div class="field">
              <label>ุงูุจูุฏ ${n} โ ุดููููุฉ</label>
              <div>
                ${[1,2,3,4,5].map(i => `<label><input type="radio" name="ุงูุจูุฏ ${n} โ ุดููููุฉ" value="${i}"> ${i}</label>`).join(' ')}
              </div>
            </div>

            <div class="field">
              <label>ุงูุจูุฏ ${n} โ ูุฑุงุฑ</label>
              <div>
                <label><input type="radio" name="ุงูุจูุฏ ${n} โ ูุฑุงุฑ" value="ููุงุณุจ"> ููุงุณุจ</label>
                <label><input type="radio" name="ุงูุจูุฏ ${n} โ ูุฑุงุฑ" value="ูุญุชุงุฌ ุชุนุฏูู"> ูุญุชุงุฌ ุชุนุฏูู</label>
                <label><input type="radio" name="ุงูุจูุฏ ${n} โ ูุฑุงุฑ" value="ุบูุฑ ููุงุณุจ"> ุบูุฑ ููุงุณุจ</label>
              </div>
            </div>
          </div>

          <div class="field">
            <label>ุงูุจูุฏ ${n} โ ููุงุญุธุงุช</label>
            <textarea name="ุงูุจูุฏ ${n} โ ููุงุญุธุงุช" rows="3" placeholder="ููุงุญุธุงุช ูุฎุชุตุฑุฉ"></textarea>
          </div>

          <hr />
        </div>
      `;
    }

    function createItemPages() {
      const chunkSize = 6;
      const pagesWrap = document.getElementById('pages');
      let pageIndex = 2; // ูุฏููุง page0, page1 ูุณุจููุง

      for (let i = 0; i < ITEM_NUMBERS.length; i += chunkSize) {
        const chunk = ITEM_NUMBERS.slice(i, i + chunkSize);
        const blocks = chunk.map(n => createItemBlock(n)).join('');
        const sec = document.createElement('section');
        sec.className = 'page';
        sec.id = 'page' + pageIndex;
        sec.innerHTML = `
          <h2>ูุญุงูุฑ ุงูุจููุฏ (${chunk[0]}โ${chunk[chunk.length - 1]})</h2>
          ${blocks}
          <div class="navigation-buttons">
            <button class="btn btn-secondary" type="button" onclick="prevPage()">ุงูุณุงุจู</button>
            <button class="btn" type="button" onclick="nextPage()">ุงูุชุงูู</button>
          </div>
        `;
        pagesWrap.appendChild(sec);
        pageIndex++;
      }
    }

    // ========= ุญุงูุฉ ูููู ุงูุตูุญุงุช =========
    window.formData = {};
    let pages = [];
    let currentPage = 0;

    function refreshPages() {
      pages = Array.
